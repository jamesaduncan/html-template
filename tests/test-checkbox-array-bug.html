<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HTMLTemplate Checkbox Array Bug Test Case</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
        }
        #output {
            background-color: #fff;
            padding: 20px;
            border: 2px solid #4CAF50;
            border-radius: 4px;
        }
        .test-results {
            background-color: #f5f5f5;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
        }
        .error {
            color: #d32f2f;
        }
        .success {
            color: #388e3c;
        }
    </style>
</head>
<body>
    <h1>HTMLTemplate Checkbox Array Bug Test</h1>

    <div class="section">
        <h2>Template:</h2>
        <!-- Template with checkbox array syntax -->
        <template id="test-template">
            <div itemscope itemtype="https://example.com/User">
                <p>Notifications:</p>
                <label><input type="checkbox" itemprop="notifications[]" value="email" disabled> Email</label>
                <label><input type="checkbox" itemprop="notifications[]" value="sms" disabled> SMS</label>
                <label><input type="checkbox" itemprop="notifications[]" value="push" disabled> Push</label>
            </div>
        </template>
        <pre><code>&lt;template id="test-template"&gt;
    &lt;div itemscope itemtype="https://example.com/User"&gt;
        &lt;p&gt;Notifications:&lt;/p&gt;
        &lt;label&gt;&lt;input type="checkbox" itemprop="notifications[]" value="email" disabled&gt; Email&lt;/label&gt;
        &lt;label&gt;&lt;input type="checkbox" itemprop="notifications[]" value="sms" disabled&gt; SMS&lt;/label&gt;
        &lt;label&gt;&lt;input type="checkbox" itemprop="notifications[]" value="push" disabled&gt; Push&lt;/label&gt;
    &lt;/div&gt;
&lt;/template&gt;</code></pre>
    </div>

    <div class="section">
        <h2>Data:</h2>
        <pre id="data-display"></pre>
    </div>

    <div class="section">
        <h2>Rendered Output:</h2>
        <div id="output"></div>
    </div>

    <div class="section">
        <h2>Test Results:</h2>
        <div class="test-results" id="test-results"></div>
    </div>

    <script type="module">
        import { HTMLTemplate } from '../index.mjs';

        // Data with array of selected values
        const data = {
            "@type": "User",
            "@context": "https://example.com",
            notifications: ['email', 'sms']
        };

        // Display the data
        document.getElementById('data-display').textContent = JSON.stringify(data, null, 2);

        // Get template and render
        const template = new HTMLTemplate(document.getElementById('test-template'));
        const rendered = template.render(data);
        document.getElementById('output').appendChild(rendered);

        // Run tests
        const results = [];
        
        // Test 1: Check if [] is removed from itemprop
        const checkboxesNormal = rendered.querySelectorAll('[itemprop="notifications"]');
        const checkboxesWithBrackets = rendered.querySelectorAll('[itemprop="notifications[]"]');
        
        results.push({
            test: "itemprop should have [] removed",
            expected: "3 checkboxes with itemprop='notifications'",
            actual: `${checkboxesNormal.length} with 'notifications', ${checkboxesWithBrackets.length} with 'notifications[]'`,
            passed: checkboxesNormal.length === 3 && checkboxesWithBrackets.length === 0
        });

        // Test 2: Check if checkboxes are properly checked
        const allCheckboxes = rendered.querySelectorAll('input[type="checkbox"]');
        const checkStates = {};
        allCheckboxes.forEach(cb => {
            checkStates[cb.value] = cb.checked;
        });

        results.push({
            test: "Email checkbox should be checked",
            expected: "checked = true",
            actual: `checked = ${checkStates.email}`,
            passed: checkStates.email === true
        });

        results.push({
            test: "SMS checkbox should be checked",
            expected: "checked = true",
            actual: `checked = ${checkStates.sms}`,
            passed: checkStates.sms === true
        });

        results.push({
            test: "Push checkbox should NOT be checked",
            expected: "checked = false",
            actual: `checked = ${checkStates.push}`,
            passed: checkStates.push === false
        });

        // Display results
        const resultsHtml = results.map(r => `
            <div class="${r.passed ? 'success' : 'error'}">
                <strong>${r.test}</strong><br>
                Expected: ${r.expected}<br>
                Actual: ${r.actual}<br>
                Status: ${r.passed ? '✓ PASSED' : '✗ FAILED'}
            </div>
        `).join('<hr>');

        document.getElementById('test-results').innerHTML = resultsHtml;

        // Log to console for debugging
        console.log('Rendered HTML:', rendered.outerHTML);
        console.log('Test Results:', results);
    </script>
</body>
</html>